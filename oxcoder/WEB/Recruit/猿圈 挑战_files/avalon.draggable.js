define(["avalon"],function(i){var m={ghosting:false,delay:0,axis:"xy",started:true,start:i.noop,beforeStart:i.noop,drag:i.noop,beforeStop:i.noop,stop:i.noop,scrollPlugin:true,scrollSensitivity:20,scrollSpeed:20};var q=document.getElementById("avalonStyle");var B=".ui-helper-global-drag *{ -webkit-touch-callout: none;"+"-khtml-user-select: none;"+"-moz-user-select: none;"+"-ms-user-select: none;"+"user-select: none;}"+".ui-helper-global-drag img{-webkit-user-drag:none; "+"pointer-events:none;}";try{q.innerHTML+=B}catch(w){q.styleSheet.cssText+=B}var n;var u=navigator.userAgent;var y=/Android/i.test(u);var g=/BlackBerry/i.test(u);var o=/IEMobile/i.test(u);var l=/iPhone|iPad|iPod/i.test(u);var p=y||g||o||l;if(!p){var r="mousedown";var v="mousemove";var s="mouseup"}else{r="touchstart";v="touchmove";s="touchend"}var f=i.bindingHandlers.draggable=function(F,D){var H=F.value.match(i.rword)||[];var I=H[0]||"$";var e=H[1]||"draggable";var G,C;if(I!="$"){G=i.vmodels[I];if(!G){return}}F.element.removeAttribute("ms-draggable");if(!G){G=D.length?D[0]:null}var K=G||{};if(G&&typeof G[e]==="object"){C=G[e];if(C.$model){C=C.$model}K=C}var E=F.element;var J=i(E);var L=i.mix({},m,C||{},F[e]||{},i.getWidgetData(E,"draggable"));"drag,stop,start,beforeStart,beforeStop".replace(i.rword,function(M){var N=L[M];if(typeof N==="string"){if(typeof K[N]==="function"){L[M]=K[N]}}});if(L.axis!==""&&!/^(x|y|xy)$/.test(L.axis)){L.axis="xy"}n=document.body;J.bind(r,function(S){var Q=i.mix({},L,{element:E,$element:J,pageX:z(S,"X"),pageY:z(S,"Y"),marginLeft:parseFloat(J.css("marginLeft"))||0,marginTop:parseFloat(J.css("marginTop"))||0});Q.startPageX=Q.pageX;Q.startPageY=Q.pageY;L.axis.replace(/./g,function(U){Q["drag"+U.toUpperCase()]=true});if(!Q.dragX&&!Q.dragY){Q.started=false}if(typeof L.beforeStart==="function"){L.beforeStart.call(Q.element,S,Q)}if(Q.handle&&K){var P=K[Q.handle];P=typeof P==="function"?P:Q.handle;if(typeof P==="function"){var O=P.call(E,S,Q);if(O&&O.nodeType===1){if(!E.contains(O)){return}}else{return}}}j();var N=J.css("position");if(!/^(?:r|a|f)/.test(N)){E.style.position="relative";E.style.top="0px";E.style.left="0px"}if(L.delay&&isFinite(L.delay)){Q.started=false;setTimeout(function(){Q.started=true},L.delay)}var M=J.offset();if(L.ghosting){var T=E.cloneNode(true);i(T).css("opacity",0.7).width(E.offsetWidth).height(E.offsetHeight);Q.clone=T;if(N!=="fixed"){T.style.position="absolute";T.style.top=M.top-Q.marginTop+"px";T.style.left=M.left-Q.marginLeft+"px"}n.appendChild(T)}var R=i(Q.clone||Q.element);Q.startLeft=parseFloat(R.css("left"));Q.startTop=parseFloat(R.css("top"));Q.endLeft=parseFloat(J.css("left"))-Q.startLeft;Q.endTop=parseFloat(J.css("top"))-Q.startTop;Q.clickX=Q.pageX-M.left;Q.clickY=Q.pageY-M.top;a(L,Q);f.dragData=Q;"start,drag,beforeStop,stop".replace(i.rword,function(U){f[U]=[L[U]]});f.plugin.call("start",S,Q)})};var d={"X":"Left","Y":"Top"};f.dragData={};f.start=[];f.drag=[];f.stop=[];f.beforeStop=[];f.plugin={add:function(e,E){for(var C in E){var D=E[C];if(typeof D==="function"&&Array.isArray(f[C])){D.isPlugin=true;D.pluginName=e+"Plugin";f[C].push(D)}}},call:function(C,F,E){var G=f[C];if(Array.isArray(G)){G.forEach(function(e){if(typeof e.pluginName==="undefined"?true:E[e.pluginName]){e.call(E.element,F,E)}})}if(C==="stop"){for(var D in f){G=f[D];if(Array.isArray(G)){G.forEach(function(e){if(!e.isPlugin){i.Array.remove(G,e)}})}}}}};var A=new Date-0,t=document.querySelector?12:30;i(document).bind(v,function(F){var E=new Date-A;if(E>t){A=E;var D=f.dragData;if(D.started===true){F.preventDefault();var C=D.clone||D.element;c(F,C,D,"X");c(F,C,D,"Y");f.plugin.call("drag",F,D)}}});i(document).bind(s,function(E){var D=f.dragData;if(D.started===true){b();var C=D.element;f.plugin.call("beforeStop",E,D);if(D.dragX){c(E,C,D,"X",true)}if(D.dragY){c(E,C,D,"Y",true)}if(D.clone){n.removeChild(D.clone)}f.plugin.call("stop",E,D);f.dragData={}}});function z(D,E){var C="page"+E;return p?D.changedTouches[0][C]:D[C]}function c(K,J,I,M,F){var L=z(K,M);if(I.containment){var G=M==="X"?I.containment[0]:I.containment[1];var N=M==="X"?I.containment[2]:I.containment[3];var D=L-(M==="X"?I.clickX:I.clickY);if(D<G){L+=Math.abs(G-D)}else{if(D>N){L-=Math.abs(N-D)}}}I["page"+M]=L;var H=d[M];var C=H.toLowerCase();var E=I["start"+H]+L-I["startPage"+M]+(F?I["end"+H]:0);I[C]=E;if(I["drag"+M]){J.style[C]=E+"px"}}var h=document.documentElement;var j=function(){i(h).addClass("ui-helper-global-drag")};var b=function(){i(h).removeClass("ui-helper-global-drag")};if(window.VBArray&&!("msUserSelect" in h.style)){var x;function k(){var C=window.event||{};C.returnValue=false}j=function(){x=n.onselectstart;n.onselectstart=k};b=function(){n.onselectstart=x}}function a(I,G){if(!I.containment){if(Array.isArray(G.containment)){return}G.containment=null;return}var E=G.$element.width();var D=G.$element.height();if(I.containment==="window"){var H=i(window);G.containment=[H.scrollLeft(),H.scrollTop(),H.scrollLeft()+H.width()-G.marginLeft-E,H.scrollTop()+H.height()-G.marginTop-D];return}if(I.containment==="document"){G.containment=[0,0,i(document).width()-G.marginLeft,i(document).height()-G.marginTop];return}if(Array.isArray(I.containment)){var C=I.containment;G.containment=[C[0],C[1],C[2]-E,C[3]-D];return}if(I.containment==="parent"||I.containment.charAt(0)==="#"){var F;if(I.containment==="parent"){F=G.element.parentNode}else{F=document.getElementById(I.containment.slice(1))}if(F){var e=i(F).offset();G.containment=[e.left+G.marginLeft,e.top+G.marginTop,e.left+F.offsetWidth-G.marginLeft-E,e.top+F.offsetHeight-G.marginTop-D]}}}return i});