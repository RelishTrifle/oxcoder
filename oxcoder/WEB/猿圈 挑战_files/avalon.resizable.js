define(["../draggable/avalon.draggable"],function(b){var a=b.bindingHandlers.draggable;var c=b.bindingHandlers.resizable=function(l,i){var p=l.value.match(b.rword)||["$","resizable"];var q=p[0].trim(),g=p[1],m,h;if(q&&q!="$"){m=b.vmodels[q];if(!m){return}}if(!m){m=i.length?i[0]:null}var r=m||{};if(m&&typeof m[g]==="object"){h=m[g];if(h.$model){h=h.$model}r=h}var k=l.element;k.removeAttribute("ms-resizable");var s=b.mix({},c.defaults,h||{},b.getWidgetData(k,"resizable"));"stop,start,resize,drag".replace(b.rword,function(t){var u=s[t];if(typeof u==="string"){if(typeof r[u]==="function"){s[t]=r[u]}else{s[t]=b.noop}}});s.handles=s.handles.match(b.rword)||["all"];s._aspectRatio=typeof s.aspectRatio==="number";var o=b(k);o.bind("mousemove",function(u){if(s.started){return}var t=e(u,o,s);s._cursor=o.css("cursor");if(t===""){o.css("cursor","default")}else{o.css("cursor",t+"-resize")}});o.bind("mouseleave",function(t){o.css("cursor",s._cursor);delete s._cursor});var j=s.drag||b.noop;var n=document.body;s.beforeStart=function(u,v){var w=v.$element;v.dragX=v.dragY=false;var t=e(u,w,v);if(t===""){return}b.mix(v,{dir:t,startResizeLeft:f(w,"left"),startResizeTop:f(w,"top"),startResizeWidth:w.width(),startResizeHeight:w.height()});"startResizeLeft,startResizeTop,startResizeWidth,startResizeHeight".replace(b.rword,function(x){v[x.replace("startR","r")]=v[x]});v.aspectRatio=v._aspectRatio?v.aspectRatio:((v.startResizeWidth/v.startResizeHeight)||1);u.type="resizestart";b(n).css("cursor",t+"-resize")};s.drag=function(t,u){if(u.dir){d(t,u.$element,u);t.type="resize";u.resize.call(u.element,t,u)}else{if("_cursor" in s){j.call(u.element,t,u)}}};s.beforeStop=function(t,u){if(u.dir){var v=u.$element;d(t,v,u);delete u.dir;t.type="resizeend";b(n).css("cursor","default")}};l.value="";l.draggable=s;a(l,i)};c.defaults={handles:"n,e,s,w,ne,se,sw,nw",maxHeight:10000,maxWidth:10000,minHeight:10,minWidth:10,cursor:false,edge:5,start:b.noop,resize:b.noop,stop:b.noop};function e(o,p,m){var j="";var k=p.offset();var g=p[0].offsetWidth;var q=p[0].offsetHeight;var h=m.edge;if(o.pageY>k.top&&o.pageY<k.top+h){j+="n"}else{if(o.pageY<k.top+q&&o.pageY>k.top+q-h){j+="s"}}if(o.pageX>k.left&&o.pageX<k.left+h){j+="w"}else{if(o.pageX<k.left+g&&o.pageX>k.left+g-h){j+="e"}}for(var l=0,n;n=m.handles[l++];){if(n==="all"||n===j){return j}}return""}function f(h,g){var i=parseInt(h.css(g),10);if(isNaN(i)){return 0}else{return i}}function d(g,q,o){var r=o;if(o._aspectRatio||g.shiftKey){var p=true,l=r.minHeight*o.aspectRatio,k=r.minWidth/o.aspectRatio,s=r.maxHeight*o.aspectRatio,j=r.maxWidth/o.aspectRatio;if(l>r.minWidth){r.minWidth=l}if(k>r.minHeight){r.minHeight=k}if(s<r.maxWidth){r.maxWidth=s}if(j<r.maxHeight){r.maxHeight=j}}if(o.dir.indexOf("e")!==-1){var h=o.startResizeWidth+g.pageX-o.startPageX;h=Math.min(Math.max(h,r.minWidth),r.maxWidth);o.resizeWidth=h;if(p){o.resizeHeight=h/o.aspectRatio}}if(o.dir.indexOf("s")!==-1){var t=o.startResizeHeight+g.pageY-o.startPageY;t=Math.min(Math.max(t,r.minHeight),r.maxHeight);o.resizeHeight=t;if(p){o.resizeWidth=t*o.aspectRatio}}if(o.dir.indexOf("w")!==-1){o.resizeWidth=o.startResizeWidth-g.pageX+o.startPageX;if(o.resizeWidth>=r.minWidth&&o.resizeWidth<=r.maxWidth){o.resizeLeft=o.startResizeLeft+g.pageX-o.startPageX;if(p){o.resizeTop=o.startResizeTop+(g.pageX-o.startPageX)/o.aspectRatio}}}if(o.dir.indexOf("n")!==-1){o.resizeHeight=o.startResizeHeight-g.pageY+o.startPageY;if(o.resizeHeight>=r.minHeight&&o.resizeHeight<=r.maxHeight){o.resizeTop=o.startResizeTop+g.pageY-o.startPageY;if(p){o.resizeLeft=o.startResizeLeft+(g.pageY-o.startPageY)*o.aspectRatio}}}var n={left:o.resizeLeft,top:o.resizeTop,width:o.resizeWidth,height:o.resizeHeight};for(var m in n){q.css(m,n[m])}}return b});